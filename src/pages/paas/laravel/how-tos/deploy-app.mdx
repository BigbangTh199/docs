import Layout from "@/components/Layout";
import Button from "@/components/Common/button";
import Section from "@/components/Common/section";
import Alert from "@/components/Common/alert";
import Tabs from "@/components/Common/tab";
import Step from "@/components/Common/step";
import Card from "@/components/Common/card";
import Important from "@/components/Common/important";
import Highlight from "@/components/Common/highlight";
import Link from "next/link";
import { GoArrowLeft, } from "react-icons/go";
import NextPage from "@/components/Common/nextpage";


import Head from "next/head";

<Layout>
<Head>
<title>مستندات استقرار برنامه‌های Laravel - لیارا</title>
</Head>

# استقرار برنامه Laravel در لیارا
<hr className="mb-2" />

        <Tabs 
    tabs={["Liara Console", "Liara CLI"]} 
    content={[
    <>
        <p>
            در ابتدا، پس از <a className="blue-link" href="./create-app">ساخت برنامه</a> بایستی تمام فایل‌ها و پوشه‌هایی که قصد ندارید در لیارا آپلود شوند را، از پروژه پاک کنید. به عنوان مثال، باید پوشه‌های node_modules و vendor را از پروژه خود پاک کنید؛ چرا که لیارا در حین فرایند استقرار، آن‌ها را برای شما ایجاد خواهد کرد. به صورت کلی، اگر که در پروژه خود فایلی به نام <Important>gitignore.</Important> دارید، کافیست تا فایل‌های و دایرکتوری‌های اشاره شده در این فایل را، از پروژه خود پاک کنید.
        </p>

        <p>
            همچنین، پروژه شما باید شامل فایل <Important>composer.json</Important> باشد؛ لیارا، در حین فرایند استقرار، به صورت خودکار این فایل را پیدا می‌کند و عملیات زیر را، انجام می‌دهد:
        </p>
        <Step  steps={[
            {
            step: "۱",
            content: (
            <>
                <h4>اضافه کردن mirror</h4>
                <p>لیارا، در ابتدا، در فایل <Important>composer.json</Important>، برای افزایش سرعت دانلود و نصب پکیج‌های تعریف شده، mirror اختصاصی خود را، اضافه می‌کند تا پکیج‌ها از آن بارگذاری و نصب شوند.</p>
            </>
            )
            },
            {
            step: "۲",
            content: (
            <>
                <h4>نصب وابستگی‌های برنامه</h4>
                <p>بعد از اضافه کردن mirror، لیارا با استفاده از دستور <Important>composer install</Important> تمامی پکیج‌ها و وابستگی‌های برنامه را نصب می‌کند. پس حتماً در نظر داشته باشید که اسامی آن‌ها در این فایل، تعریف شده باشد.</p>
            </>
            )
            },
        ]}/>
        <div className="h-4" />
        <p>
            قطعه کد زیر، یک نمونه از فایل <Important>composer.json</Important> استاندارد برای برنامه‌های Laravel است:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": ["laravel", "framework"],
    "license": "MIT",
    "require": {
        "php": "^8.2",
        "laravel/framework": "^11.9",
        "laravel/tinker": "^2.9"
    },
    "require-dev": {
        "fakerphp/faker": "^1.23",
        "laravel/pint": "^1.13",
        "laravel/sail": "^1.26",
        "mockery/mockery": "^1.6",
        "nunomaduro/collision": "^8.0",
        "phpunit/phpunit": "^11.0.1"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi",
            "@php -r \"file_exists('database/database.sqlite') || touch('database/database.sqlite');\"",
            "@php artisan migrate --graceful --ansi"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}
`}
            </Highlight>
        </div>
        <div className='h-4' />
        <Alert variant='error'>
        <p>
        همچنین بهتر است برای استقرار موفق، فایل <Important>composer.lock</Important> درون پروژه خود را 
        (در صورت وجود) پاک کنید تا در حین فرایند استقرار، لیارا آن را، ایجاد کند.
        </p>
        </Alert>
        <div className='h-4' />
        
        <p>
            در ادامه، بایستی پوشه پروژه خود را درون یک فایل zip قرار بدهید؛ سپس در برنامه خود، بر روی گزینه <b>استقرار جدید</b> کلیک کرده؛ فایل zip را بکشید و در باکس آپلود تعبیه شده، رها کنید تا وارد مرحله بعدی استقرار شوید:
        </p>
        <img src="https://files.liara.ir/liara/docs/deploy-app-using-console.gif" alt="deploy app using console" />
        <div className="h-4" />
        <p>
            پس از آپلود پروژه، باید شخصی‌سازی‌های پروژه را در برنامه خود، لحاظ کنید:
        </p>
        <div className="h-4" />
        <img src="https://files.liara.ir/liara/docs/deploy-laravel-app-using-console.gif" alt="build app on liara" />
        <div className="h-4" />
        <p>
            در انتها، به صورت مستقیم به <a href="../../details/private-registry" className="blue-link">صفحه تاریخچه برنامه</a> هدایت می‌شوید که می‌توانید لاگ‌های مربوط به استقرار را در آن، مشاهده بفرمایید. 
        </p>

    </>,

    <>

        <p>
            پس از <a className='blue-link' href="./create-app">ساخت برنامه</a>، باید در مسیر اصلی پروژه، یک فایل به نام <Important>liaraignore.</Important> یا <Important>gitignore.</Important> ایجاد کنید و درون آن، اسامی تمامی فایل‌ها یا پوشه‌هایی که قصد ندارید در لیارا آپلود شوند را، وارد کنید؛ به عنوان مثال، نیازی به آپلود دایرکتوری‌های node_modules و vendor به همراه محتوای آن‌ها نیست؛ چرا که لیارا در حین استقرار برنامه، آن‌ها را برای شما می‌سازد؛ پس بایستی اسامی این دایرکتوری‌ها در یکی از دو فایل فوق، نوشته شود؛ قطعه کد قرار گرفته در لینک زیر، یک <Important>gitignore.</Important> عالی برای برنامه‌های Laravel است که می‌توانید از آن، استفاده کنید:
        </p>
        <div className="h-2" />
        <Link href="https://github.com/liara-cloud/gitignore-templates/blob/master/laravel/.gitignore" target="_blank">
            <Card className="flex cursor-pointer w-full items-center justify-between">
                <div className="flex items-center gap-3">
                <h4>
                    نمونه فایل <Important>gitignore.</Important> برای برنامه‌های Laravel
                </h4>
                </div>
                <GoArrowLeft className="ml-1" />
            </Card>
        </Link>
        <div className="h-2" />
        <p>
            همچنین، پروژه شما باید شامل فایل <Important>composer.json</Important> باشد؛ لیارا، در حین فرایند استقرار، به صورت خودکار این فایل را پیدا می‌کند و عملیات زیر را، انجام می‌دهد:
        </p>
        <Step  steps={[
            {
            step: "۱",
            content: (
            <>
                <h4>اضافه کردن mirror</h4>
                <p>لیارا، در ابتدا، در فایل <Important>composer.json</Important>، برای افزایش سرعت دانلود و نصب پکیج‌های تعریف شده، mirror اختصاصی خود را، اضافه می‌کند تا پکیج‌ها از آن بارگذاری و نصب شوند.</p>
            </>
            )
            },
            {
            step: "۲",
            content: (
            <>
                <h4>نصب وابستگی‌های برنامه</h4>
                <p>بعد از اضافه کردن mirror، لیارا با استفاده از دستور <Important>composer install</Important> تمامی پکیج‌ها و وابستگی‌های برنامه را نصب می‌کند. پس حتماً در نظر داشته باشید که اسامی آن‌ها در این فایل، تعریف شده باشد.</p>
            </>
            )
            },
        ]}/>
        <div className="h-4" />
        <p>
            قطعه کد زیر، یک نمونه از فایل <Important>composer.json</Important> استاندارد برای برنامه‌های Laravel است:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": ["laravel", "framework"],
    "license": "MIT",
    "require": {
        "php": "^8.2",
        "laravel/framework": "^11.9",
        "laravel/tinker": "^2.9"
    },
    "require-dev": {
        "fakerphp/faker": "^1.23",
        "laravel/pint": "^1.13",
        "laravel/sail": "^1.26",
        "mockery/mockery": "^1.6",
        "nunomaduro/collision": "^8.0",
        "phpunit/phpunit": "^11.0.1"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi",
            "@php -r \"file_exists('database/database.sqlite') || touch('database/database.sqlite');\"",
            "@php artisan migrate --graceful --ansi"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}
`}
            </Highlight>
        </div>
        <div className='h-4' />
        <Alert variant='error'>
        <p>
        همچنین بهتر است برای استقرار موفق، فایل <Important>composer.lock</Important> درون پروژه خود را 
        (در صورت وجود) پاک کنید تا در حین فرایند استقرار، لیارا آن را، ایجاد کند.
        </p>
        </Alert>
        <div className='h-4' />
        <p>
            در ادامه، در مسیر اصلی پروژه، یک فایل به نام <Important>liara.json</Important> ایجاد کنید و قطعه کد زیر را در آن قرار دهید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "app": "my-web-app", 
    "platform": "laravel"
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
            در قطعه کد فوق، در فیلد <Important>app</Important> باید شناسه برنامه خود را به جای <Important>my-web-app</Important> وارد کنید.
            در فیلد <Important>platform</Important> باید نوع پلتفرم خود را که laravel است، مشخص کنید.
        </p>
        <p>
            از آنجایی که لیارا برای نصب پکیج‌های <Important>composer</Important>، از <Important>mirror</Important> اختصاصی خود استفاده می‌کند؛ از همین رو، ممکن است که در نصب برخی از پکیج‌های جدید، دچار مشکل شود. برای رفع این مشکل، می‌توانید mirror لیارا را با قراردادن قطعه کد زیر در فایل <Important>liara.json</Important>، غیرفعال کنید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "laravel": {
    "composerMirror": false
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
            برای تعیین نسخه PHP  برنامه خود نیز، کافیست تا در فایل <Important>liara.json</Important> فیلد <Important>phpVersion</Important> را قرار دهید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "laravel": {
      "phpVersion": "8.3"
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <Alert variant='success'>همچنین بخوانید:  <a className="blue-link" href="./choose-version">نسخه‌های قابل ارائه php و Laravel در لیارا</a></Alert>
        <p>
            به صورت پیش‌فرض، منطقه‌ی زمانی برنامه‌تان بر روی Asia/Tehran تنظیم شده است؛ برای تغییر مقدار پیش‌فرض، می‌توانید از پارامتر <Important>timezone</Important> در فایل <Important>liara.json</Important> استفاده کنید؛ به عنوان مثال:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "laravel": {
      "timezone": "America/Los_Angeles"
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
            لیارا در حین استقرار برنامه‌تان، دستور <Important>npm run production</Important> را اجرا می‌کند و با اجرای این دستور، فایل‌های SASS به CSS و کدهای جاوا اسکریپت ES6 به بالا به ES5 تبدیل و یکپارچه، می‌شوند.
        </p>
        <p>
            اگر که از Laravel فقط برای ساخت API استفاده کرده‌اید و یا به طور کلی، نیازی به این ندارید که لیارا پکیج‌های npm را نصب و فایل‌های CSS و JS را build کند؛ می‌توانید در فایل <Important>liara.json</Important> پارامتر <Important>buildAssets</Important> را به شکل زیر، تنظیم کنید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "laravel": {
       "buildAssets": false
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
            همچنین، برای نصب پکیج‌هایی که در بخش <Important>require-dev</Important> فایل <Important>composer.json</Important> قرار دارد (مانند <Important>Faker</Important> و <Important>Ignition</Important>)، باید در فایل <Important>liara.json</Important>، پارامتر <Important>installDevDependencies</Important> را به شکل زیر، تنظیم کنید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
  "laravel": {
    "installDevDependencies": true
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
        برای تجربه عملکرد بهتر، Laravel توصیه می‌کند تا فایل‌های config و route را با اجرای دستورات <Important>php artisan config:cache</Important> و <Important>php artisan route:cache</Important>، کش کنید. شما می‌توانید برای اجرای خودکار این دستورات توسط لیارا در هر بار استقرار، پارامترهای مربوطه را به شکل زیر در فایل <Important>liara.json</Important> وارد کنید:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
  "laravel": {
    "configCache": true,
    "routeCache": true
  }
}`}
            </Highlight>
        </div>
        <div className='h-4' />
        <Alert variant="error">
        <p>توجه داشته باشید که <a href="https://laravel.com/docs/5.8/deployment#optimization" className="">طبق مستندات لاراول</a>، استفاده از دستور <Important>php artisan route:cache</Important> تنها زمانی امکان‌پذیر است که شما از Closureها برای تعریف routeها استفاده نکرده باشید و فقط از Controller استفاده کرده باشید.</p>
        </Alert>
        <div className='h-4' />
        <p>
            در نهایت، یک فایل <Important>liara.json</Important> می‌تواند مانند قطعه کد زیر باشد:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`{
    "app": "my-web-app",
    "platform": "laravel",
    "laravel":{
        "phpVersion": "8.3",
        "mirror": false,
        "timezone": "America/Los_Angeles",
        "installDevDependencies": true,
        "configCache": true,
        "routeCache": true
    }
}
`}
            </Highlight>
        </div>
        <div className='h-4' />
        <Alert variant='success'>همچنین بخوانید: <a className="blue-link" href="../../details/build-location">تعیین موقعیت build برنامه</a></Alert>
        <p>
            اکنون کافیست تا در مسیر اصلی پروژه و جایی که فایل <Important>liara.json</Important> قرار دارد؛ دستور زیر را اجرا کنید و منتظر بمانید تا عملیات استقرار تمام شود:
        </p>
        <div className="h-4" />
        <div dir='ltr'>
            <Highlight className="json">
                {`liara deploy`}
            </Highlight>
        </div>
        <div className='h-4' />
        <p>
            در حین فرایند استقرار، می‌توانید در ترمینال خود، لاگ‌های مربوط به آن را مشاهده بفرمایید.
        </p>
    </>,

]} 
/>

<Alert variant='success'>
برای دسترسی به فایل‌های پوشه‌های <Important>storage</Important>، طبق مستندات لاراول باید این پوشه به پوشه‌ی <Important>public</Important> لینک شود. لیارا به‌صورت خودکار، در زمان استقرار، دستور <Important>php artisan storage:link</Important> را اجرا می‌کند و نیازی نیست که اقدام خاصی انجام دهید.

</Alert>

<Alert variant='success'>
<p>
    پس از استقرار برنامه می‌توانید <a href="../../details/events" className="blue-link">رویدادها</a> و <a href="../../details/observations/about" className="blue-link">گزارشات</a> مربوط به برنامه را بررسی کنید.
</p>
</Alert>


<NextPage next="./set-envs" />
</Layout>