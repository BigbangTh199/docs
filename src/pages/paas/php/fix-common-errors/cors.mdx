import Layout from "@/components/Layout";
import Button from "@/components/Common/button";
import Section from "@/components/Common/section";
import Alert from "@/components/Common/alert";
import Tabs from "@/components/Common/tab";
import Step from "@/components/Common/step";
import Card from "@/components/Common/card";
import Important from "@/components/Common/important";
import Highlight from "react-highlight";
import Link from "next/link";
import NextPage from "@/components/Common/nextpage";
import {GoArrowLeft,} from "react-icons/go";

<Layout>
# رفع خطای CORS در برنامه‌های Laravel
<hr className="mb-2" />
خطای CORS (Cross-Origin Resource Sharing) یک محدودیت امنیتی در مرورگرها است که جلوی درخواست‌های HTTP از منابع مختلف را می‌گیرد. 
این خطا ممکن است زمانی رخ دهد که سعی کنید از یک دامنه یا پورت متفاوت به سروری دیگر درخواست ارسال کنید، و معمولاً با پیام خطایی شبیه به <b>Access-Control-Allow-Origin</b> در مرورگر مواجه خواهید شد. در ادامه، به رفع این خطا در فریم‌ورک‌های مختلف، پرداخته شده است:

برای حل این مشکل می‌توانید از راه حل‌‌های قرار داده شده، استفاده کنید.

<Section id="use-laravel-cors-package" title="استفاده از پکیج laravel-cors" />
در ابتدا، کافیست تا با اجرای دستور زیر، این پکیج را در پروژه خود، در لوکال، نصب کنید:

<div className="h-2" />
<div dir='ltr'>
    <Highlight className="bash">
      {`composer require fruitcake/laravel-cors`}
    </Highlight>
</div>
<div className="h-2" />

البته اگر که به خطای conflict برخورد کردید؛ کافیست تا پکیج‌های قدیمی مربوطه با ورژن barryvdh یا fruitcake را با اجرای دستور مثال زیر، حذف کرده و مجدداً آن را نصب کنید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="bash">
      {`composer remove barryvdh/laravel-cors fruitcake/laravel-cors
composer require fruitcake/laravel-cors`}
    </Highlight>
</div>
<div className="h-2" />

در ادامه، بایستی، یک middleware به نام <Important>HandleCors</Important> در ابتدای property به نام <Important>middleware$</Important> در فایل <Important>app/Http/Kernel.php</Important> با محتوای زیر، اضافه کنید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="php">
      {`protected $middleware = [
  \\Fruitcake\\Cors\\HandleCors::class,
    // ...
];`}
    </Highlight>
</div>
<div className="h-2" />

تمامی کارها انجام شده است و کافیست دستور زیر را اجرا کنید تا مقادیر پیش‌فرض مربوط به CORS در مسیر <Important>config/cors.php</Important> برای‌تان قرار بگیرد و پس از آن، می‌توانید این مقادیر را بنا به نیاز خود، تغییر دهید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="bash">
      {`php artisan vendor:publish --tag="cors"`}
    </Highlight>
</div>
<div className="h-2" />
<Alert variant='success'>
<p>
همچنین بخوانید: <a href="https://github.com/fruitcake/laravel-cors?tab=readme-ov-file#cors-middleware-for-laravel" className="blue-link">مستندات مربوط به پکیج laravel-cors</a>
</p>
</Alert>

<Section id="use-htaccess" title="تنظیم فایل htaccess." />
کافیست تا وارد فایل <Important>public/.htaccess</Important> شوید و تنظیمات مربوط به CORS را به پروژه خود اضافه کنید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="config">
      {`Header set Access-Control-Allow-Origin "*"

<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>`}
    </Highlight>
</div>
<div className="h-2" />



</Layout>